// Generated by CoffeeScript 1.7.1
(function() {
  var HomeController, libr,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  libr = angular.module('libr.controllers.home', ['ionic']);

  HomeController = (function() {
    var isUserLogedIn, showLoading;

    HomeController.$inject = ['$scope', '$location', 'BookService', 'ScanService', '$ionicLoading', '$ionicActionSheet', 'RecommendService'];

    function HomeController($scope, $location, BookService, ScanService, $ionicLoading, $ionicActionSheet, RecommendService) {
      this.$scope = $scope;
      this.$location = $location;
      this.$ionicLoading = $ionicLoading;
      this.$ionicActionSheet = $ionicActionSheet;
      this.RecommendService = RecommendService;
      this.showRecommendActionSheet = __bind(this.showRecommendActionSheet, this);
      if (isUserLogedIn()) {
        showLoading(this.$scope, this.$ionicLoading);
        BookService.getBooks().success((function(_this) {
          return function(result) {
            _this.$scope.books = result.books;
            _this.$scope.enableBackButton = false;
            _this.$scope.rightButtons = [
              {
                type: 'button  icon ion-shuffle',
                tap: function(e) {
                  return _this.showRecommendActionSheet();
                }
              }
            ];
            return _this.$scope.loading.hide();
          };
        })(this));
      } else {
        this.$location.path('/tab/settings');
        return;
      }
    }

    showLoading = function($scope, $ionicLoading) {
      return $scope.loading = $ionicLoading.show({
        content: '加载中',
        animation: 'fade-in',
        showBackdrop: true,
        maxWidth: 200,
        showDelay: 500
      });
    };

    isUserLogedIn = function() {
      if (localStorage.getItem('token') !== null && localStorage.getItem('email') !== null) {
        return true;
      } else {
        return false;
      }
    };

    HomeController.prototype.showRecommendActionSheet = function() {
      return this.$ionicActionSheet.show({
        titleText: '推荐',
        buttons: this.RecommendService.getActionSheetList(),
        destructiveText: '删除',
        cancelText: '取消',
        cancel: function() {
          return console.log('CANCELLED');
        },
        buttonClicked: function(index) {
          console.log('BUTTON CLICKED', index);
          return true;
        },
        destructiveButtonClicked: function() {
          console.log('DESTRUCT');
          return true;
        }
      });
    };

    return HomeController;

  })();

  libr.controller('HomeCtrl', HomeController);

}).call(this);
