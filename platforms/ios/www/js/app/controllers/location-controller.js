// Generated by CoffeeScript 1.7.1
(function() {
  var LocationController, libr,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  libr = angular.module('libr.controllers.location', ['ionic']);

  LocationController = (function() {
    LocationController.$inject = ['$scope', '$location', 'GeolocationService'];

    function LocationController($scope, $location, GeolocationService) {
      this.$scope = $scope;
      this.$location = $location;
      this.GeolocationService = GeolocationService;
      this.addLocation = __bind(this.addLocation, this);
      this.$scope.enableBackButton = false;
      this.$scope.rightButtons = [
        {
          type: 'button icon ion-ios7-plus',
          tap: (function(_this) {
            return function(e) {
              return _this.addLocation();
            };
          })(this)
        }
      ];
      this.$scope.itemButtons = [
        {
          text: '删除',
          type: 'button-assertive',
          onTap: (function(_this) {
            return function(item) {
              return _this.GeolocationService.deleteLocation(item, function(result) {
                return _this.$scope.locations.splice(_this.$scope.locations.indexOf(item), 1);
              });
            };
          })(this)
        }
      ];
      this.GeolocationService.getLocations((function(_this) {
        return function(locations) {
          return _this.$scope.locations = locations;
        };
      })(this));
      this.GeolocationService.getDetailAddress((function(_this) {
        return function(position) {
          localStorage.setItem('cur_address_detail', position.result.formatted_address);
          localStorage.setItem('cur_lat', position.result.location.lat);
          localStorage.setItem('cur_lng', position.result.location.lng);
          return _this.$scope.address = position.result.formatted_address;
        };
      })(this));
    }

    LocationController.prototype.addLocation = function() {
      if (this.$scope.locations.length >= 3) {
        return alert('只能创建3个常用的地址哦，你可以尝试删除部分，再添加');
      } else {
        return this.GeolocationService.createLocation((function(_this) {
          return function(result) {
            return _this.$scope.locations.push(result);
          };
        })(this));
      }
    };

    return LocationController;

  })();

  libr.controller('LocationController', LocationController);

}).call(this);
